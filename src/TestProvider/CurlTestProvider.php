<?php

/**
 * NOTICE OF LICENSE
 *
 * This source file is subject to the MIT licence
 * that is bundled with this package in the file LICENSE.
 * 
 * @author Jean-Baptiste Romain - Realdev.fr
 * @since 2023
 */

namespace Jbromain\WafPentest\TestProvider;

/**
 * Provides CurlTest.
 * Reads the test configuration from JSON files or via php include().
 */
class CurlTestProvider implements TestProviderInterface
{

    /**
     * Domain to test, without scheme or final slash.
     */
    private string $domain;

    /**
     * @var string Default URL scheme. Each test can override this default.
     */
    private string $default_scheme = "https://";

    /**
     * @var int Default port. Each test can override this default.
     */
    private int $default_port = 443;

    /**
     * @var string[] Defaults HTTP headers. Each test can override these defaults.
     */
    private array $default_headers = [];


    /**
     * Loads test configuration form json files located in a directory.
     * Reads json files recursiverly. They will be performed in alphanumeric order.
     * All test configuration files must have .json extension. Other files will be ignored.
     * 
     * @param string $path Path of the directory to read; absolute path is prefered.
     * @return bool True if at least one test configuration file has been read
     */
    public function loadFromJsonFiles(string $path): bool
    {
        // TODO


        return false;
    }

    public function getTests(): array
    {
        // Prepare each test and returns them to the engine
        // TODO
        return [];
    }

    /**
     * Defines the domain name who will be the target of the tests.
     * Example: www.example.com 
     * 
     * @param string $domain In lowercase, without protocol or final slash, but including subdomain
     * @param string $scheme Default value; each test can override it
     * @param int $port Default value; each test can override it
     * @return self To allow chaining
     */
    public function configureDomain(string $domain, string $scheme = "https://", int $port = 443): self
    {
        $this->domain = $domain;
        $this->default_scheme = $scheme;
        $this->default_port = $port;
        return $this;
    }


    /**
     * Each test can provide a list of http headers. 
     * This method allows you to define the default headers.
     * If a header is also defined in a test configuration, it will override the default value.
     *
     * @param string[] $headers For example ['User-Agent: Waf-PenTest', 'X-myheader: 1']
     * @return self To allow chaining
     */
    public function configureDefaultHttpHeaders(array $headers): self
    {
        $this->default_headers = $headers;
        return $this;
    }
}
